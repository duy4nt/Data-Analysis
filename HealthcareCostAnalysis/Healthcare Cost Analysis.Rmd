---
title: "Healthcare Cost Analysis"
author: "Prateek Singh"
date: "2026-02-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

The rapid digitization of healthcare system has generated unprecedented volumes of patient data, creating new opportunities for data-driven insights and intelligent clinical decision making. This analysis uses the Healthcare Dataset from Kaggle, which contains 1,338 record of individual insurance beneficiaries along with their associated annual medical charges.

The dataset comprises seven variables spanning demographic, lifestyle and geological attributes. Specifically it included a beneficiary's age, sex, BMI(Body Mass Index), number of dependent children, smoking status, residential region and insurance charges.

The primary objective of this analysis include an Exploratory Data Analysis, conducted to uncover underlying distributions, correlation, and patterns within the dataset and how they effect the cost paid by the insurance; and Predictive Modeling Techniques,aimed at accurately estimating individual insurance charges based other factors.

The sex, smoker and region variables are qualitative values, explaining the lifestyle of the person; while the age, BMI, children and charges variables are the quantitative values. Age column specifies the age of the person; Sex column specifies the gender of the person; Children column specifies the number of dependent children; Smoker columns specifies whether the person smokes or not. Region column specifies the region to which the person belongs to in the country; Charges column specifies the amount paid by the person to the insurance, commonly known as premium in Dollars(\$). BMI column specifies the Body Mass Index of the person.

Body Mass Index(BMI) is a screening tool that uses height and weight to estimate if a person has a healthy body weight. It acts as an indirect indicator of the body fatness and helps access risk for health conditions like heart disease and diabetes. The formula used to calculate the values of BMI variable is `weight(kg)/(height(m))^2`.

Although BMI is a widely used and useful indicator of healthy body weight. It does have its own limitations. BMI is an estimate that cannot take the body composition into account.

BMI Prime is the ratio of a person's measured BMI to the upper limit of BMI that is considered "normal", by the institutions such as the WHO and the CDC. This is the World Health Organization(WHO) recommended body weight based in BMI for adults. It is used for both men and women, age 20 or older:

|                    |           |               |
|--------------------|-----------|---------------|
| **Classification** | **BMI**   | **BMI Prime** |
| Severe Thinness    | \<16      | \<0.64        |
| Moderate Thinness  | 16 - 17   | 0.64 - 0.68   |
| Mild Thinness      | 17 - 18.5 | 0.68 - 0.74   |
| Normal             | 18.5 - 25 | 0.74 - 1      |
| Overweight         | 25 - 30   | 1 - 1.2       |
| Obese Class I      | 30 - 35   | 1.2 - 1.4     |
| Obese Class II     | 35 - 40   | 1.4 - 1.6     |
| Obese Class III    | \>40      | \>1.6         |

BMI prime allows us to make a quick assessment of how much a person's BMI differs from the upper limit of BMI that is considered normal.

Being overweight increases the risk of a number of serious diseases and health conditions. Below is a list of said risks, according to the Centers for Disease Controls and Prevention(CDC):

-   High blood pressure

-   Higher Level of LDL cholesterol

-   Type II diabetes

-   Coronary heart disease

-   Stroke

-   Gallbladder disease

-   Osteoarthritis, a type of joint disease caused by breakdown of joint cartilage.

-   Sleep apnea and breathing problems and etc.

Being underweight has its own associated risks, listed below:

-   Malnutrition, vitamin deficiency, anemia.

-   Osteoporosis, a disease that causes bone weakness, increasing the risk of breaking bones.

-   A decrease in the immune function.

-   Growth and development issues.

Importing the necessary libraries for the analysis, i.e. `dplyr` for performing complex data transformation and `ggplot2` for the data visualization. The dataset lacks date variable hence date cleaning libraries such as `libridate` is not required.

```{r}
library(dplyr)
library(ggplot2)
library(visdat)
library(caTools)
library(Metrics)
library(reshape2)
```

```{r}
hccd <- read.csv("insurance.csv")
```

## Data Overview

```{r}
colnames(hccd)
```

```{r}
head(hccd)
```

```{r}
str(hccd)
```

```{r}
summary(hccd)
```

The initial inspection of the dataset describes the distribution of information and provides descriptive statistics of each quantitative variables such as age, BMI, children and charges, but explains the quality of the qualitative variables such as sex, smoker and region. The summary statistics provide the minimum value, each quartile, and the mean, median and the maximum values. The range of the values within each quantitative variables and measure of central tendency is also known.

The next step is to understand the data quality. Understanding the frequency and location of missing information is crucial for future analysis. The `visdat` package is used below to visually explain instances of missing information in each of the variables. From this visualization it is evident that all the information is present, but that only partially ensures all information is high enough quality to begin analysis.

```{r}
vis_miss(hccd)
```

In addition to searching for missing information , a through search should be conducted to identify duplicated rows. The code snippet below searched rows to identify any instances of duplicate values. While it is possible that cost paid was same, the dataset contains four quantitative variables describing age, BMI, number of dependent children and charges and three qualitative variables describing sex, lifestyle and region. It is highly doubtful for a person to not only contain an exact copy of those quantitative variables but also unlikely for those variables to create an exact match in cost. In the original dataset, 1 instance of duplicated row must be removed, found by the command `sum(duplicate(hccd))`.

```{r}
hccd <- hccd %>% distinct()
```

From the summary earlier in the analysis, it was found that there are charges, BMI and age were always more than 0; which means that our dataset is clean and can state that further analysis will be more accurate.

```{r}
hccd %>% group_by(sex) %>% count()
```

The tibble shows the distribution of the sex in the dataset. Out of the 1337 people, 675 are males and 662 are females.

```{r}
hccd %>% group_by(smoker) %>% summarise(mean(charges))
```

The tibble shows the mean of the charge with respect to the lifestyle of the person. It is apparent that a smoker had to pay significantly more charge than the non smoker.

```{r}
hccd %>% group_by(sex) %>% summarise(mean(charges))
```

The tibble shows the mean of the charge with respect to the gender of the person. It is apparent that males had to pay more charge than the females, to be specific males had to pay about 11% more than females. The lifestyle of the is the prime suspect here.

```{r}
hccd %>% filter(sex == 'male') %>% group_by(smoker) %>% count() %>% summarise(percent = n*100/675)
```

```{r}
hccd %>% filter(sex == 'female') %>% group_by(smoker) %>% count() %>% summarise(percent = n*100/662)
```

The tibble shows that distribution of smokers in both of the genders. There were more men in the dataset than women. 24% men were smokers, while only 17% women were smokers. This explains the 11% more charge paid by men to the insurance.

```{r}
hccd %>% group_by(region) %>% summarise(mean(charges))
```

```{r}
hccd %>% group_by(region) %>% count()
```

The tibble shows the mean of the charge with respect to the region. The people living in the southwest region have to pay the highest charge, while people living in the southwest have to pay the lowest charge. The latter tibble shows the distribution of the customers; the southeast region has the highest number of customers, while other region have equal number of customers.

```{r}
hccd %>% group_by(children) %>% summarise(mean(charges))
```

The average charge paid by the person increases as the number of children increases, but this trend is only visible till 3 children, after that it falls sharply, which might be an anomaly and needs some further analysis such as number of people. The only way this anomaly can be explained is by assuming that if the person can have 5 children, then they have lesser chance of getting sick and claiming their insurance.

```{r}
hccd %>% group_by(children) %>% count()
```

The tibble shows the distribution of the people with respect to the number of children.

## Data Visualization

```{r}
hccd %>% ggplot(aes(x = bmi, y = charges, color = age)) + geom_point() + labs(title = "Scatter plot of BMI and Charge with Age of the Person", x = "BMI", y = "Charge($)", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The scatter plot above shows us some interesting patters. The plot shows 2 things, firstly that as BMI increases the charge tends to increase, but is not certainly, secondly as the age increase, the charge paid by the person certainly increase. 

```{r}
hccd %>% ggplot(aes(x = charges)) + geom_histogram(aes(fill = after_stat(x)) ,color = "white") + scale_fill_gradient(low = "skyblue", high = "steelblue4") + labs(title = "Distribtion of the charge paid by the People", x = "Charge($)", y = " Count", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The histogram above shows the distribution of the charge paid by the customers. Most of the customers of the insurance company are towards the lower end of the charge spectrum. While we see an anomaly around `$37000 - $39000`, but the pattern is clear.

The suspect for the above pattern is the age of the people in the dataset. 

```{r}
hccd %>% ggplot(aes(x = age)) + geom_histogram(aes(fill = after_stat(x)), color = "white", bins = 10) + scale_fill_gradient(low = "skyblue", high = "steelblue4") + labs(title = "Distribution of Age in the dataset", x = "Age", y = "Count", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The age distribution histogram confirms the assumption that there are abnormally more people in the age range of 18-27. Our dataset is biased towards the younger people and the model made on the dataset will not be very accurate for the older people. 

Younger people tend to pay less charge to the company when compared to old people, hence it might reduce their profit. But this is can also prove to be beneficial as younger people claim their insurance less often. 

```{r}
hccd %>% ggplot(aes(x = bmi)) + geom_histogram(aes(fill = after_stat(x)), color = "white", bins = 10) + scale_fill_gradient(low = "skyblue", high = "steelblue4") + labs(title = "Distribution of BMI in the dataset", x = "BMI", y = "Count", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The BMI in the dataset is normally distributed, with most of the people falling in the normal to overweight category. 

```{r}
hccd %>% ggplot(aes(x = children)) + geom_histogram(aes(fill = after_stat(x)), color = "white") + scale_fill_gradient(low = "skyblue", high = "steelblue4") + labs(title = "Distribution of Age in the dataset", x = "Age", y = "Count", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The above distribution shows how many children the customers of the insurance had. About 43% of the total customers had 0 children, while 24% of the total customers had 1 child and similar trend follow.

```{r}
hccd %>% ggplot(aes(x = age, y = charges, color = smoker)) + geom_point() + labs(title = "Scatter plot of Age and Charge with Smoking Status", x = "Age", y = "Charge($)", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle") 
```

The above scatter plot shows some interesting patters. The main trend we observe is that as the person's age increases, the charge tend to increase and in general smokers have to pay more than the non smokers. The plot can be divided into 3 groups. The non-smoking category(the bottom group), the smoking category(the top group) and the exceptions(the middle group). The top and bottom groups are self explanatory but the middle group is a collection of exception. There are people who do not smoke but still pay more than a smoker who is older than them. 

The above is the unexplained part of the analysis. 

```{r}
hccd %>% group_by(region) %>% summarise(z = mean(charges)) %>% ggplot(aes(x = region, y = z, fill = region)) + geom_col() + theme_light() + labs(title = "Average charge by Region", x = "Region", y = "Charge($)", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle") 
```

The above bar char is a general distribution of the people in the regions. With the southeast housing 12% more customers than the other regions, while other regions sit close to each other with 324 customers.

```{r}
hccd %>% group_by(sex) %>% summarise(z = mean(charges)) %>% ggplot(aes(x = sex, y = z, fill = sex)) + geom_col() + labs(title = "Average charge by Sex", x = "Sex", y = "Charge($)", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The above plot suggest that there are males tend to pay more charge than the females, which was also observed in the data overview section. How does sex effect the age and charge distribution?

```{r}
hccd %>% ggplot(aes(x = age, y = charges, color = sex)) + geom_point() + labs(title = "Scatter plot of Age and Charge with Smoking Status", x = "Age", y = "Charge($)", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The scatter plot suggests that there is not correlation between price charged and gender of the person. How does charge distribution looks like with respect to the number of dependent children?

```{r}
hccd %>% group_by(children) %>% summarise(z = mean(charges)) %>% ggplot(aes(x = children, y = z, fill = children)) + geom_col() + labs(title = "Average charge with respect to the number of children", x = "Number of Children", y = "Mean Charge($)", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle")
```

The above bar chart shows the charge distribution with respect to the number of children. There is a trend initially and then there is an anomaly. It is logical to charge more price as the number of dependent children increase, and this trend is observed till 3 children. After 3 children, a drop of 9.7% percent was observed, then a drop of 37% was observed for charges of people with 5 children. 

To explain the anomaly, an assumption had to made that people with 4 or 5 or more children tend to be fit and claim their insurance less frequently when compared to 1 - 3 children.  

```{r}
hccd %>% select(age, bmi, children, charges) %>% cor() %>% melt() %>% ggplot(aes(x = Var1, y = Var2, fill = value)) + geom_tile(color = "white") + scale_fill_gradient(low = "white", high = "steelblue") + labs(title = "Correlation between Age, BMI, Children and Charges", subtitle = "Healthcare Cost Dataset", caption = "Data source: Kaggle", x = "Variables", y = "Variables") + theme_minimal()
```

The heat map shows that there is a high correlation between age and charge, but not so strong relation with other quantities. 

## Model Building and Evaluation

Encoding the categorical values like sex, smoker and region so that our model is able to understand them. Two types of encoding will be used in our dataset ,i.e. Label Encoding and One Hot Encoding. 

Label Encoding is the process of converting binary categorical variables into numerical values of 0 and 1. In this analysis, the sex and smoker variables were label encoded. For example, "yes" and "no" for smoker were converted to 1 and 0 respectively. This works well for binary variables as there are only two categories and no false ranking is introduced.

One Hot Encoding is the process of converting categorical variables with more than two categories into multiple binary columns, one for each category. Each column contains a 1 if the person belongs to that category and 0 otherwise â€” similar to a truth table. In this analysis, the region variable with 4 categories was one hot encoded. This prevents the model from assuming any false ranking or order between categories.

The `as.factor()` function will help in encoding the categorical values into factors, which then can used in the model. 

```{r}
hccd <- hccd %>% mutate(sex = as.factor(sex))
hccd <- hccd %>% mutate(smoker = as.factor(smoker))
hccd <- hccd %>% mutate(region = as.factor(region))
```

To make the analysis reproducible, a seed is set with the digits `7717`. Randomness in analysis (e.g., train/test splits, data shuffling, model weights) can lead to inconsistent results. Setting a seed ensures that these processes are deterministic, enabling consistent outputs for debugging, validation, and collaboration.

```{r}
set.seed(7717)
```

Splitting the dataset into 2 data frames i.e. One for training and one for testing. The dataset will be divided into 80-20 ratio as the dataset contains only 1337 rows, so that the model has sufficient data to be trained on. 

```{r}
split <- sample.split(hccd$bmi, SplitRatio = 0.8)
train_data <- subset(hccd, split == TRUE)
test_data <- subset(hccd, split == FALSE)
```

There is our train and test dataset, with 1121 and 216 rows respectively. 

```{r}
lm_model <- lm(charges ~ ., data = train_data)
summary(lm_model)
```

The Adjusted R-squared was 0.75, which mean that our model is able to explain 75% of the variation present in the dataset, the other 25% was not explained by our model, which can be due to the variables which effect the premium of the insurance but are not present in the dataset. 

The 75% R-squared is a decent number. Lets now test the model on the test data.

```{r}
predicted_data <- predict(lm_model, test_data)
mae(test_data$charges, predicted_data)
rmse(test_data$charges, predicted_data)
```

The MAE is 4313.642 and RMSE is 6225.119. A difference of 43% is observed between them, which suggests that there are large outliers i.e. conditions where our model is way off. 

## Conclusion and Limitations

### Conclusion

The aim of the analysis was to do an EDA of the dataset and train a model on the dataset to predict the charge given the conditions. While performing the Exploratory data analysis, we came across many interesting insights, also some not so sure trends and some anomalies. 

While performing the analysis we found that charge was dependent on the age, but this to be considered a fact, more analysis is required. Specially the relationship between smoker and the charges, which was a categorical value.

The charge increases as the number of children increase, but interestingly after 3 children, a drop in the charges is observed, this anomaly could be explained by assuming that people who can have more than 3 children are usually health and would claim their insurance less often than the people with lesser children. 

Interestingly southeast region pays the most premium as well as has the maximum number of customers. 

It was expected that men smoker more, which is confirmed by the analysis and tend to pay more premium than women, provided that all the conditions remain the same. 

The EDA suggests that most of the customers lie in the charge bracket of `$0` to `$15000`. 

For our model we used Linear Regression as it is one of the simplest to implement and good for regression problems. The model performed decent, with Adjusted R-squared of 0.748, MAE of `$4314` and RMSE of `$6225`. The MAE suggests that there could be an error of  `$4313` and RMSE suggests that when the model makes big mistake, then the error reaches about `$6225`. 

Furthermore we get an error of about 30% error(best case scenario) which is not acceptable for real world.  

### Limitations

-   The background of the dataset is not known.

-   There are only 1337 rows.

-   Dataset is biased towards the younger people.

-   Other factor which effect the premium are missing from the dataset, such as previous medical conditions, the neighborhood in which you live etc. 

-   The model explain 75% of the variance and on an average it is about `$4000` off. And most of the customers lie in the charge range of `$0` to `$15000`, so the model has an error of 26%, which is the best case scenario. An error of 30% is unacceptable in the real world, hence we need a better model.   